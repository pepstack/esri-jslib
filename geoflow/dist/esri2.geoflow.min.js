/******************************************************************************
 * esri2.geoflow.js
 *
 * Version: 0.0.1pre
 *
 * Copyright (c) 2012-2013 Esri
 *
 * All rights reserved under the copyright laws of the United States.
 * You may freely redistribute and use this software, with or
 * without modification, provided you include the original copyright
 * and use restrictions.  See use restrictions in the file:
 * <install location>/License.txt
 *
 * Last Date: 
 *****************************************************************************//**
 * esri2.geoflow.js
 */
(function(a,b){__using_script(__get_script_path(a)+b)})("/esri2.geoflow.js","esri2.map.js"),function(a,b){"use strict";var c=!0,d=!1,e=null,f=-1,g="    ",h=function(a){return'"'+a+'"'},i=function(){};i.GridSize=24,i.BkgndGrid="BkgndGrid",i.LinkCutter="LinkCutter",i.CutterSize=32,i.MaxPorts=i.MaxNodes=40,i.InRender="_inRdr",i.OutRender="_outRdr",i.NodeIconSize=16,i.NodeBoxName="NodeBox",i.NodeShadowName="NodeShadow",i.NodeHeadName="NodeHead",i.NodeCaption="NodeCaption",i.NodeIconName="NodeIcon",i.NodeEditName="NodeEdit",i.NodeDropName="NodeDrop",i.NodeAssignment="Assignment",i.NodeDefaultVal="DefaultVal",i.NodeDispatch="Dispatch",i.NodeFeature="Feature",i.NodeGeometry="Geometry",i.NodeGpAsync="GpAsync",i.NodeGpSync="GpSync",i.NodePubInput="PubInput",i.NodePubOutput="PubOutput",i._TypeNum=9,i._TypeIDs={},i._TypeIDs[i.NodeAssignment]=0,i._TypeIDs[i.NodeDefaultVal]=1,i._TypeIDs[i.NodeDispatch]=2,i._TypeIDs[i.NodeFeature]=3,i._TypeIDs[i.NodeGeometry]=4,i._TypeIDs[i.NodeGpAsync]=5,i._TypeIDs[i.NodeGpSync]=6,i._TypeIDs[i.NodePubInput]=7,i._TypeIDs[i.NodePubOutput]=8,i.__matchTable=[0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,0,1,0,0,1,0,1,1,1,0,1,0,0,1,1,1,1,1,0,1,0,0,1,1,1,1,1,0,1,0,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],i.setMatchTable=function(a,b,c){var d=i._TypeIDs[a],e=i._TypeIDs[b];i.__matchTable[d*i._TypeNum+e]=c},i.getMatchTable=function(a,b){var c=i._TypeIDs[a],d=i._TypeIDs[b];return i.__matchTable[c*i._TypeNum+d]},i.NodeInPort="InPort",i.NodeOutPort="OutPort",i.OutDotR=i.InDotR=6,i.RoundR=8,i.InPortDY=3,i.OutPortDY=4,i.OutPortSel="outport-sel",i.OutPortUnsel="outport-unsel",i.OutPortLinked="outport-linked",i.InPortSel="inport-sel",i.InPortUnsel="inport-unsel",i.InPortLinked="inport-linked",i.createLinkRenders=function(){var a=new esri2.Map.Render("#outl");a.setFill(null),a.setStroke("#666",2,"round"),a.setShadow(5,"#404040",2,2);var b=new esri2.Common.PairArray;b.insert(a.name,a);return b},i.createLinkSelRenders=function(){var a=new esri2.Map.Render("#outl");a.setFill(null),a.setStroke("#246096",3,"round"),a.setShadow(5,"#404040",2,2);var b=new esri2.Map.Render("#inl");b.setFill(null),b.setShadow(null),b.setStroke("#DFFAFE",2,"round");var c=new esri2.Common.PairArray;c.insert(a.name,a),c.insert(b.name,b);return c},i.createPortSymbol=function(a,b){var c=new esri2.Map.Symbol(a);c.symbolUnit.baseY=c.symbolUnit.baseX=8;var d=new esri2.Map.Shape(c);d.createRectXY(0,0,16,16),d.selectable=!0;var e=d.useDefaultRender();e.setStroke(null),e.setFill(null,b.getImage(a)),c.addShape(d),c.updateBound();return c},i.createIconRect=function(a,b,c,d,e,f,g,h,j){var k,l=new esri2.Map.Shape(a);l.addAttribute("NAME",c),b.addAttribute(c,l),l.createRectXY(0,0,h,j),l.renderName=i.OutRender,k=l.addRender(i.InRender),k.setStroke(null),k.setFill(null,d),k=l.addRender(i.OutRender),k.setStroke(null),k.setFill(null,e),l.selectable=f,l.eventHandler=g;return l},i.createNodeIcon=function(a,b,c){var d=b.imagesLib.getImage(c.toString()+"_"),e=b.imagesLib.getImage(c.toString()),f=i.createIconRect(a,a,i.NodeIconName,d,e,!0,null,i.NodeIconSize,i.NodeIconSize);return f},i.createEditIcon=function(a,b){var c=b.imagesLib.getImage(i.NodeEditName+"_"),d=b.imagesLib.getImage(i.NodeEditName),e=i.createIconRect(a,a,i.NodeEditName,c,d,!0,j.editNodeHandler,i.NodeIconSize,i.NodeIconSize);return e},i.createDropIcon=function(a,b){var c=b.imagesLib.getImage(i.NodeDropName+"_"),d=b.imagesLib.getImage(i.NodeDropName),e=i.createIconRect(a,a,i.NodeDropName,c,d,!0,j.dropNodeHandler,i.NodeIconSize,i.NodeIconSize);return e},i.createNodeShadow=function(a,b,c){var d=new esri2.Map.Shape(a);a.addAttribute(i.NodeShadowName,d),d.createRoundRectXY(0,0,b,c,i.RoundR),d.selectable=!1;var e=d.useDefaultRender();e.setStroke("#222",4),e.setFill(null),e.setShadow(6,"#404040",3,3);return d},i.createNodeBox=function(a,b,c){var d=new esri2.Map.Shape(a);a.addAttribute(i.NodeBoxName,d),d.createRoundRectXY(0,0,b,c,i.RoundR);var e=d.addRender(i.InRender);e.setStroke("#EFEFEF",3),e.setShadow(null),e.setLinearGradient(["both","NWSE"],[0,"#EFEFEF"],[1,"#FFFFFF"]),e=d.addRender(i.OutRender),e.setStroke("#DADADA",3),e.setLinearGradient(["both","NWSE"],[0,"#DADADA"],[1,"#FAFAFA"]),e.setShadow(null),d.renderName=i.OutRender,d.selectable=!0,d.eventHandler=j.nodeBoxHandler;return d},i.updateDrawNode=function(a,b,c,d){var e=a.getAttribute(i.NodeBoxName),f=a.getAttribute(i.NodeShadowName),g=a.getAttribute(i.NodeCaption);g.addAttribute("TEXT",d),e.createRoundRectXY(0,0,b,c,i.RoundR),f.createRoundRectXY(0,0,b,c,i.RoundR),a.updateBound()},i.createNodeHead=function(a,b,c){var d,e,f=new esri2.Map.Shape(a);a.addAttribute(i.NodeHeadName,f),f.createRoundRectXY(0,0,b,c,i.RoundR),e=l.DefaultStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setShadow(null),d.setLinearGradient(["fill","NWSE"],[0,"#a0a0a0"],[1,"#f0f0f0"]),e=l.DefaultStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setShadow(null),d.setLinearGradient(["fill","NWSE"],[0,"#808080"],[1,"#cdcdcd"]),e=l.InitializedStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setLinearGradient(["fill","NWSE"],[0,"#6AE8DB"],[1,"#B1F3ED"]),d.setShadow(null),e=l.InitializedStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setFill("#6AE8DB"),d.setShadow(null),e=l.SucceededStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setLinearGradient(["fill","NWSE"],[0,"#34B14C"],[1,"#B6F0C8"]),d.setShadow(null),e=l.SucceededStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setFill("#34B14C"),d.setShadow(null),e=l.FailedStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setLinearGradient(["fill","NWSE"],[0,"#ED1C24"],[1,"#FAB8BB"]),d.setShadow(null),e=l.FailedStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setFill("#ED1C24"),d.setShadow(null),e=l.RunningStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setLinearGradient(["fill","NWSE"],[0,"#00A2E8"],[1,"#B0E8FF"]),d.setShadow(null),e=l.RunningStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setFill("#00A2E8"),d.setShadow(null),e=l.PausedStatus+i.InRender,d=f.addRender(e),d.setStroke(null),d.setLinearGradient(["fill","NWSE"],[0,"#FF7F27"],[1,"#FFCAA6"]),d.setShadow(null),e=l.PausedStatus+i.OutRender,d=f.addRender(e),d.setStroke(null),d.setFill("#FF7F27"),d.setShadow(null),f.renderName=l.DefaultStatus+i.OutRender;return f},i.createNodeCaption=function(a,b,c){var d=b.nodW,e=new esri2.Map.Shape(a);a.addAttribute(i.NodeCaption,e),e.createRectXY(0,0,d-i.GridSize*3,c-4),e.addAttribute("TEXT","Undefined "+b.toString());var f=e.addRender(i.InRender);f.setStroke(null),f.setFill(null),f.setShadow(null),f.setText("#111","TEXT","left"),f.setFont("normal",300,"9pt","sans-serif"),f=e.addRender(i.OutRender),f.setStroke(null),f.setFill(null),f.setShadow(null),f.setText("#444","TEXT","left"),f.setFont("normal",300,"9pt","sans-serif"),e.renderName=i.OutRender,__browser.chrome?e.offset(i.GridSize,4):e.offset(i.GridSize,6);return e},i.createInPort=function(a,b,c,d,e){var f,g=new esri2.Map.Shape(c);g.createRectXY(0,0,d-i.GridSize,i.GridSize-4),g.addAttribute("TEXT",c.displayName),g.addAttribute("PORT_TEXT",!0),g.renderName=i.OutRender,f=g.addRender(i.InRender),f.setStroke(null),f.setFill(null),f.setShadow(null),c.required===!0?(f.setText("#111","TEXT","left"),f.setFont("normal","bold","10pt","sans-serif")):(f.setText("#111","TEXT","left"),f.setFont("normal","normal","10pt","sans-serif")),f=g.addRender(i.OutRender),f.setStroke(null),f.setFill(null),f.setShadow(null),c.required===!0?(f.setText("#555","TEXT","left"),f.setFont("normal","bold","10pt","sans-serif")):(f.setText("#555","TEXT","left"),f.setFont("normal","normal","10pt","sans-serif"));var h=i.createIconRect(c,b,c.getTypeId(),a.imagesLib.getImage(i.NodeInPort+"_"),a.imagesLib.getImage(i.NodeInPort),!1,null,i.NodeIconSize,i.NodeIconSize),k=new esri2.Map.Shape(c);k.createCircleXY(0,0,i.InDotR),k.selectable=!0,k.eventHandler=j.nodePortHandler,c.tagShape=k,f=k.useDefaultRender(),f.setStroke(null),f.setShadow(null),f.setFill("#fff"),h.offset(-10,(e+1)*i.GridSize-8),k.offset(-2,(e+1)*i.GridSize),__browser.chrome?g.offset(10,(e+.5)*i.GridSize+i.InPortDY):g.offset(10,(e+.5)*i.GridSize+i.InPortDY+1),h.addAttribute("port:symbol",b),k.addAttribute("port:symbol",b),g.addAttribute("port:symbol",b),b.addShapesFront(h,k,g)},i.createOutPort=function(a,b,c,d,e){var f,g=new esri2.Map.Shape(c);g.createRectXY(0,0,d-i.GridSize,i.GridSize-4),g.addAttribute("TEXT",c.displayName),g.addAttribute("PORT_TEXT",!0),g.renderName=i.OutRender,f=g.addRender(i.InRender),f.setStroke(null),f.setFill(null),f.setShadow(null),c.required===!0?(f.setText("#111","TEXT","right"),f.setFont("normal","bold","10pt","sans-serif")):(f.setText("#111","TEXT","right"),f.setFont("normal",300,"10pt","sans-serif")),f=g.addRender(i.OutRender),f.setStroke(null),f.setFill(null),f.setShadow(null),c.required===!0?(f.setText("#555","TEXT","right"),f.setFont("normal","bold","10pt","sans-serif")):(f.setText("#555","TEXT","right"),f.setFont("normal",300,"10pt","sans-serif"));var h=i.createIconRect(c,b,c.getTypeId(),a.imagesLib.getImage(i.NodeOutPort+"_"),a.imagesLib.getImage(i.NodeOutPort),!1,null,i.NodeIconSize,i.NodeIconSize),k=new esri2.Map.Shape(c);k.createCircleXY(0,0,i.OutDotR),k.selectable=!0,k.eventHandler=j.nodePortHandler,c.tagShape=k,f=k.useDefaultRender(),f.setStroke(null),f.setFill("#fff"),f.setShadow(null),h.offset(d-6,(e+1)*i.GridSize-8),k.offset(d+2,(e+1)*i.GridSize),__browser.chrome?g.offset(i.GridSize/2,(e+.5)*i.GridSize+i.OutPortDY):g.offset(i.GridSize/2,(e+.5)*i.GridSize+i.OutPortDY+1),h.addAttribute("port:symbol",b),k.addAttribute("port:symbol",b),g.addAttribute("port:symbol",b),b.addShapesFront(h,k,g)},i.updateNodeRenders=function(a,b){if(__not_null(a)){var c=a.tagShape.symbol;c.getAttribute(i.NodeCaption).renderName=c.getAttribute(i.NodeIconName).renderName=c.getAttribute(i.NodeBoxName).renderName=b,c.getAttribute(i.NodeHeadName).renderName=a.execStatus+b}},i.updatePortRenders=function(a,b){if(__not_null(a)){var c=a.parentNode.tagShape.symbol,d=c.getAttribute(a.getTypeId());d.renderName=b}},i.updateLinkRenders=function(a,b,c,d){__not_null(a)&&(a.tagShape.namedRenders=b,a.fromPtShape.symbol=d,a.toPtShape.symbol=c)},i.initNodeDrawing=function(a){var b=a.typedNode,c=b.getNodeSymbol(),d=i.createNodeShadow(c,b.nodW,b.nodH),e=i.createNodeBox(c,b.nodW,b.nodH),f=i.createNodeHead(c,b.nodW,i.GridSize),g=i.createNodeCaption(c,b,i.GridSize),h=i.createNodeIcon(c,b.flowChart,b),j=i.createEditIcon(c,b.flowChart),k=i.createDropIcon(c,b.flowChart),l=(i.GridSize-i.NodeIconSize)/2;h.offset(l,l),j.offset(b.nodW-(i.NodeIconSize+l)*2,l),k.offset(b.nodW-i.NodeIconSize-l,l),c.addShapes(h,j,k,g,f,e,d),c.updateBound()},i.nodes={Assignment:{nodeIcon:"node/x64/AssignmentNode.png"},DefaultVal:{nodeIcon:"node/x64/DefaultValNode.png"},Dispatch:{nodeIcon:"node/x64/DispatchNode.png"},Feature:{nodeIcon:"node/x64/FeatureNode.png"},Geometry:{nodeIcon:"node/x64/GeometryNode.png"},GpAsync:{nodeIcon:"node/x64/GpAsyncNode.png"},GpSync:{nodeIcon:"node/x64/GpSyncNode.png"},PubInput:{nodeIcon:"node/x64/PubInputNode.png"},PubOutput:{nodeIcon:"node/x64/PubOutputNode.png"}};var j=function(){};j.nodeBoxHandler=function(a,b,c,d){var e=b.tag,f=c.tag,g=f.tag;a.type==="mousedown"?e.startPanNode(g):a.type==="mousemove"&&(e.__lbtnDown?b.setCursor("move",a):b.setCursor("pointer"),e.updateUI(a,g))},j.nodePortHandler=function(a,b,c,d){var e=b.tag;if(!e.editor.readOnly){var f=c.tag,g=f.parentNode,h=g.tagShape.symbol,i=h.getAttribute(f.getTypeId());a.type==="mousedown"?e.trackingLink.start(a,c):a.type==="mouseup"?(b.setCursor("pointer"),e.trackingLink.end(a,c)):a.type==="mousemove"&&(e.trackingLink.isTracking()?(b.setCursor("crosshair",a),e.updateUI(a,g)):(b.setCursor("pointer"),e.updateUI(a,g,f)))}},j.editNodeHandler=function(a,b,c,d){var e=b.tag,f=c.tag,g=f.tag;b.setCursor("pointer"),a.type==="click"?e.editor.showNodeDlg(g):a.type==="mousemove"&&e.updateNodeElem(f.getAttribute(i.NodeEditName))},j.dropNodeHandler=function(a,b,c,d){var e=b.tag;if(!e.editor.readOnly){var f=c.tag,g=f.tag;if(e.trackingLink.isTracking())return;b.setCursor("pointer"),a.type==="mousedown"?(b.setCursor("pointer"),e.dropNode(g),b.refresh(!0,c.bound)):a.type==="mousemove"&&e.updateNodeElem(f.getAttribute(i.NodeDropName))}},j.nodeLinkHandler=function(a,b,c,d){var e=b.tag;if(!e.editor.readOnly){if(__not_null(e.__panMap)||__not_null(e.__panNode))return;b.setCursor("pointer");if(a.type==="mousemove"){if(e.trackingLink.isTracking())return;e.linkCutter.cutter.visible||e.linkCutter.show(a,b,c.tag),e.updateUI(a,null,null,c.tag)}}};var k=function(a){this._init(a)};k.prototype._init=function(a){this.editor=a,this.linkRenders=this.linkCutter=this.trackingLink=this.linkLayer=this.nodeLayer=this.mapCanvas=null,this.__lbtnDown=!1,this.__panMap=this.__panNode=this.__selNodeElem=this.__selLink=this.__selPort=this.__selNode=null,this.__posY=this.__posX=0,this.__nodes=new esri2.Common.PairArray,this.__nodes.insert(0,null),this.__links=new esri2.Common.PairArray,this.__links.insert(0,null),this.linkShape=new esri2.Map.Shape,this.portShape=new esri2.Map.Shape},k.prototype.init=function(a,b){this.mapCanvas=a,this.imagesLib=b,this.trackingLink=new k.TrackingLink(this),this.linkCutter=new k.LinkCutter(this);if(__is_null(a)||!a.supportCanvas())throw new Error("GeoFlow.init: invalid MapCanvas object");this.mapCanvas.tag=this,a.bkgndColor="#fafafa",this.linkLayer=a.addLayer("LinkLayer"),this.nodeLayer=a.addLayer("NodeLayer"),this.linkLayer.addAttribute("LinkRenders",i.createLinkRenders()),this.linkLayer.addAttribute("LinkSelRenders",i.createLinkSelRenders()),a.addAttribute(i.OutPortSel,i.createPortSymbol(i.OutPortSel,this.imagesLib)),a.addAttribute(i.OutPortUnsel,i.createPortSymbol(i.OutPortUnsel,this.imagesLib)),a.addAttribute(i.OutPortLinked,i.createPortSymbol(i.OutPortLinked,this.imagesLib)),a.addAttribute(i.InPortSel,i.createPortSymbol(i.InPortSel,this.imagesLib)),a.addAttribute(i.InPortUnsel,i.createPortSymbol(i.InPortUnsel,this.imagesLib)),a.addAttribute(i.InPortLinked,i.createPortSymbol(i.InPortLinked,this.imagesLib)),this.linkShape.namedRenders=this.linkLayer.getAttribute("LinkSelRenders"),this.linkShape.useAllRender(),this.portShape.createPoint(0,0,0),a.updateBound(),a.zoomAll(1),a.refresh(!0)},k.prototype.toString=function(){return"GeoFlow class"},k.prototype.createNode=function(a,b,c,d,e){__log("GeoFlow.createNode: ",b,c,d);if(this.__nodes.size()>i.MaxNodes)throw new Error("GeoFlow.createNode: exceed max nodes: "+i.MaxNodes);var f=new esri2.Map.Shape,g=this.getGridXY(c,d),h=this.mapCanvas.toMapPoint(g.x*i.GridSize,g.y*i.GridSize);f.createPoint(h.x,h.y,0);var j=__is_null(a)?this.__nodes.genKey():a,k=l.create(j,b,f,this,e);__not_null(k)&&k.isValid()&&(this.__nodes.insert(k.id,k),this.nodeLayer.addShape(f),this.nodeLayer.updateBound());return k},k.prototype.addLink=function(a,b,c){var d=n.create(this.__links.genKey(),a,b);if(__not_null(d)){var e=d.update(this.mapCanvas);e.selectable=!0,e.eventHandler=j.nodeLinkHandler,e.namedRenders=this.linkLayer.getAttribute("LinkRenders"),e.useAllRender(),this.linkLayer.addShapes(e,d.toPtShape,d.fromPtShape),this.linkLayer.updateBound(),this.__links.insert(d.id,d);var f=__is_null(c)||__is_true(c);__not_null(d.fromNode.typedNode.updateOutPort)&&d.fromNode.typedNode.updateOutPort(d,f),__not_null(d.toNode.typedNode.updateInPort)&&d.toNode.typedNode.updateInPort(d,!0)}return d},k.prototype.cutLink=function(a){a.fromNode.removePort(a.fromPort),a.toNode.removePort(a.toPort),a.detachPorts(),n.removeFromLayer(this.linkLayer,a),this.__links.erase(a.id)},k.prototype.getNodeLinks=function(a){var b,c=[],d=this.__links.size();while(d-->1)b=this.__links.getVal(d),(b.fromNode===a||b.toNode===a)&&c.push(b);return c},k.prototype.clear=function(){while(this.__nodes.size()>1)this.dropNode(this.__nodes.getVal(1),!0);this.nodeLayer.updateBound(),this.linkLayer.updateBound()},k.prototype.dropNode=function(a,b){a.removeLinks(a.getAllLinks(),b),this.nodeLayer.removeAt(a.tagShape),this.__nodes.erase(a.id),b!==!0&&(this.nodeLayer.updateBound(),this.sortNodesOrder(i.NodePubInput),this.sortNodesOrder(i.NodePubOutput))},k.prototype.updateLinks=function(a){var c,d=this.getNodeLinks(a);while((c=d.pop())!==b)c.update(this.mapCanvas);this.linkLayer.updateBound()},k.prototype.sortNodesOrder=function(a){var b,c,d=[],e=this.__nodes.size();for(b=1;b<e;b++)c=this.nodeItem(b),c.getTypeName()===a&&d.push(c);for(e=d.length,b=0;b<e;b++)c=d[b],c.typedNode.orderNumb!==b+1&&c.typedNode.updateOrderNumb(b+1);return e+1},k.prototype.getNodeCount=function(){return this.__nodes.size()-1},k.prototype.getNodeById=function(a){var b=this.__nodes.find(a);if(b!==f)return this.__nodes.getVal(b);return null},k.prototype.getGridXY=function(a,b){return new esri2.Common.PointType(Math.floor(a/i.GridSize),Math.floor(b/i.GridSize))},k.prototype.snapGrid=function(a){var b=a.points[0],c=this.mapCanvas.toViewPos(b.x,b.y),d=this.getGridXY(c.x,c.y),e=this.mapCanvas.toMapPoint(d.x*i.GridSize,d.y*i.GridSize);a.offset(e.x-b.x,e.y-b.y)},k.prototype.addRender=function(a,b,c){var d=a.find(b);if(d===f){var e=new esri2.Map.Render(b,c);a.insert(e.name,e);return e}return a.getVal(d)},k.prototype.nodeItem=function(a){if(a<=0||a>=this.__nodes.size())throw new Error("invalid node index");return this.__nodes.getVal(a)},k.prototype.linkItem=function(a){if(a<=0||a>=this.__links.size())throw new Error("invalid link index");return this.__links.getVal(a)},k.prototype.updateState=function(a,b){__log("??TODO: check flowJobId with flowChart!!"),__log("GeoFlow.updateState, job: ",a);var c,d,e;for(c in b)d=b[c],e=new l.EditState(this.getNodeById(c)),e.execStatus=d.execStatus,e.errMessage=d.errMessage,e.isValid()&&e.update()},k.prototype.setMousePos=function(a){this.__posX=a._x,this.__posY=a._y},k.prototype.startPanMap=function(){this.endPanNode(),this.__panMap=this.mapCanvas.toMapPoint(0,0)},k.prototype.panningMap=function(a){if(__not_null(this.__panMap)){this.mapCanvas.panView(this.__posX,this.__posY,a._x,a._y),this.setMousePos(a),this.mapCanvas.refresh(!1);return!0}return!1},k.prototype.endPanMap=function(a){var b=this.endPanNode(),c=this.__panMap;this.__panMap=null;if(__not_null(c)){this.mapCanvas.panView(this.__posX,this.__posY,a._x,a._y),c=this.mapCanvas.toViewPos(c.x,c.y);var d=this.getGridXY(c.x,c.y);d.x*=i.GridSize,d.y*=i.GridSize,this.mapCanvas.panView(c.x,c.y,d.x,d.y),b=!0}b&&this.mapCanvas.refresh(!0);return b},k.prototype.panningNode=function(a){if(__not_null(this.__panNode)){var c=this.mapCanvas.toMapPoint(this.__posX,this.__posY),d=this.mapCanvas.toMapPoint(a._x,a._y);this.setMousePos(a),this.__panNode.tagShape.offset(d.x-c.x,d.y-c.y);var e,f=this.getNodeLinks(this.__panNode);while((e=f.pop())!==b)e.update(this.mapCanvas);this.mapCanvas.trackingLayer.updateBound(),this.mapCanvas.refreshTrackingLayer();return!0}return!1},k.prototype.hitOnShape=function(a){var b=this.mapCanvas.fastHitTest(a._x,a._y,a);if(__not_null(b)&&b.valid)return b.shape;return null},k.prototype.startPanNode=function(a){if(__is_null(a)){__log("startPanNode error: null node");return!1}this.nodeLayer.removeAt(a.tagShape),this.mapCanvas.trackingLayer.addShape(a.tagShape);var c,d=this.getNodeLinks(a);while((c=d.pop())!==b)n.insertIntoLayer(this.mapCanvas.trackingLayer,c),n.removeFromLayer(this.linkLayer,c);this.__panNode=a,this.mapCanvas.trackingLayer.updateBound(),this.mapCanvas.refresh(!1,a.tagShape);return!0},k.prototype.endPanNode=function(){var a=this.__panNode;this.__panNode=null;if(__is_null(a))return!1;this.snapGrid(a.tagShape),this.nodeLayer.addShape(a.tagShape);var c,d=this.getNodeLinks(a);while((c=d.pop())!==b)c.update(this.mapCanvas),n.insertIntoLayer(this.linkLayer,c);this.mapCanvas.trackingLayer.removeAll(),this.nodeLayer.updateBound();return!0},k.prototype.selectNode=function(a){var b=this.__selNode;this.__selNode=a;return b},k.prototype.selectPort=function(a){var b=this.__selPort;this.__selPort=a;return b},k.prototype.selectLink=function(a){var b=this.__selLink;this.__selLink=a;return b},k.prototype.updateNodeElem=function(a,b){var c=!1,d=this.__selNodeElem;this.__selNodeElem=a;if(d!==a){if(__not_null(d))if(!this.editor.readOnly||d.getAttribute("NAME")!==i.NodeDropName)d.renderName=i.OutRender,c=!0;if(__not_null(a))if(!this.editor.readOnly||a.getAttribute("NAME")!==i.NodeDropName)a.renderName=i.InRender,c=!0}c&&b!==!0&&this.mapCanvas.refresh(!1);return c},k.prototype.updateUI=function(a,b,c,d){var e=this.updateNodeElem(null,!0),f=this.selectNode(b);f!==b&&(__not_null(b)&&(i.updateNodeRenders(b,i.InRender),e=!0),__not_null(f)&&(i.updateNodeRenders(f,i.OutRender),e=!0));var g=this.selectPort(c);g!==c&&(__not_null(c)&&(i.updatePortRenders(c,i.InRender),e=!0),__not_null(g)&&(i.updatePortRenders(g,i.OutRender),e=!0));var h=this.selectLink(d);h!==d&&(__not_null(d)&&(i.updateLinkRenders(d,this.linkLayer.getAttribute("LinkSelRenders"),this.mapCanvas.getAttribute(i.InPortSel),this.mapCanvas.getAttribute(i.OutPortSel)),e=!0),__not_null(h)&&(i.updateLinkRenders(h,this.linkLayer.getAttribute("LinkRenders"),this.mapCanvas.getAttribute(i.InPortLinked),this.mapCanvas.getAttribute(i.OutPortLinked)),e=!0)),e&&this.mapCanvas.refresh(!1)},k.prototype.invokeEventHandler=function(a,b){switch(a.type){case"click":this.__lbtnDown=!1,this.trackingLink.abort();if(this.linkCutter.onClick(a,b))return;this.hitOnShape(a);break;case"mousemove":if(this.panningNode(a)||this.panningMap(a))return;if(this.trackingLink.isTracking()){this.trackingLink.tracking(a),__is_null(this.hitOnShape(a))&&this.updateUI(a),b.setCursor("move",a);return}this.mapCanvas.setCursor("default"),__is_null(this.hitOnShape(a))&&this.updateUI(a);break;case"mousedown":this.__lbtnDown=!0,b.setCursor("move",a),this.endPanMap(a),this.setMousePos(a),__is_null(this.hitOnShape(a))&&this.startPanMap();break;case"mouseup":this.__lbtnDown=!1,b.setCursor("default");if(this.endPanMap(a))return;this.trackingLink.isTracking()&&(this.hitOnShape(a),this.trackingLink.abort())}},k.prototype.loadJSON=function(a){__log("GeoFlow.loadJSON...");var c=a.knots;if(__is_null(c))throw new Error("GeoFlow.loadJSON error: knots not found");var d=a.links;if(__is_null(d))throw new Error("GeoFlow.loadJSON error: links not found");var e,f,g,h,j,k;for(e in c){f=c[e],__log("load node: ",f.name,f.type),g=this.createNode(e,f.type,f.posX,f.posY,f);if(__is_null(g))throw new Error("GeoFlow.loadJSON error: createNode exception")}var l,m,n={},o=a.internalValues;if(__not_null(o)){for(__log("load internalValues"),l=0;l<o.length;l++)m=o[l],n[m.id]===b&&(n[m.id]=Array(0)),n[m.id].push(m);for(e in n)m=n[e],this.createNode(m[0].id,i.NodeDefaultVal,m[0].posX,m[0].posY,m)}var p=a.pubInputs;if(__not_null(p)){__log("load pubInputs");for(e in p)f=p[e],this.createNode(f.id,i.NodePubInput,f.posX,f.posY,f)}var q=a.pubOutputs;if(__not_null(q)){__log("load pubOutputs");for(e in q)f=q[e],this.createNode(f.id,i.NodePubOutput,f.posX,f.posY,f)}var r,s,t,u,v,w;for(r=0;r<d.length;r++){s=d[r],__log("load link: ",s.fromPortName,s.toPortName),t=this.getNodeById(s.fromKnotId);if(__is_null(t))throw new Error("GeoFlow.loadJSON error: link has no fromNode");u=this.getNodeById(s.toKnotId);if(__is_null(u))throw new Error("GeoFlow.loadJSON error: link has no toNode");v=t.getOutPortById(s.fromPortName);if(__is_null(v))throw new Error("GeoFlow.loadJSON error: link has no fromPort");w=u.getInPortById(s.toPortName);if(__is_null(v))throw new Error("GeoFlow.loadJSON error: link has no toPort");this.addLink(v,w,!1)}},k.prototype.validate=function(){var a,b,c=this.__nodes.size();for(a=1;a<c;a++)b=this.nodeItem(a),b.validate()},k.prototype.toJsonString=function(a){var b,c=0,d=null,e=null,f="",g,j,k=__is_null(a)||__is_true(a)?!0:!1;for(f+="{\n",f+=h("knots"),f+=":{",c=this.__nodes.size(),b=1;b<c;b++){d=this.nodeItem(b);if(d.isValid()){g=d.getTypeName();if(g===i.NodeAssignment||g===i.NodeDispatch||g===i.NodeFeature||g===i.NodeGeometry||g===i.NodeGpAsync||g===i.NodeGpSync)j=f.charAt(f.length-1),j==="{"?f+="\n":j==="}"&&(f+=",\n"),f+=d.toJsonString()}}for(f+="\n},\n",f+=h("links"),f+=":[",c=this.__links.size(),b=1;b<c;b++)e=this.linkItem(b),e.ignoredNode()||(j=f.charAt(f.length-1),j==="["?f+="\n":j==="}"&&(f+=",\n"),f+=e.toJsonString());for(f+="\n],\n",f+=h("internalValues"),f+=":[",c=this.__nodes.size(),b=1;b<c;b++)d=this.nodeItem(b),d.isValid()&&(d.getTypeName()===i.NodeDefaultVal&&d.typedNode.isValid()&&(j=f.charAt(f.length-1),j==="["?f+="\n":j==="}"&&(f+=",\n"),f+=d.toJsonString()));for(f+="\n],\n",f+=h("pubInputs"),f+=":{",c=this.__nodes.size(),b=1;b<c;b++)d=this.nodeItem(b),d.isValid()&&(d.getTypeName()===i.NodePubInput&&(j=f.charAt(f.length-1),j==="{"?f+="\n":j==="}"&&(f+=",\n"),f+=d.toJsonString()));for(f+="\n},\n",f+=h("pubOutputs"),f+=":{",c=this.__nodes.size(),b=1;b<c;b++)d=this.nodeItem(b),d.isValid()&&(d.getTypeName()===i.NodePubOutput&&(j=f.charAt(f.length-1),j==="{"?f+="\n":j==="}"&&(f+=",\n"),f+=d.toJsonString()));return f+="\n}\n}"},k.TrackingLink=function(a){this.flowChart=a,this.startPort=null,this.matchedPorts=[]},k.TrackingLink.MatchPortState=function(a){this._init(a)},k.TrackingLink.MatchPortState.prototype._init=function(a){this.port=a,this.portShape=this.port.getIconShape(),this.savedRender=this.portShape.renderName,this.portShape.renderName=i.InRender},k.TrackingLink.MatchPortState.prototype.restore=function(){this.portShape.renderName=this.savedRender},k.TrackingLink.prototype={_addLinkShape:function(a,b){var c=this.flowChart.linkShape;a.x>b.x?c.createBezier(a,b,new esri2.Map.Point(a.x,b.y),new esri2.Map.Point(b.x,a.y)):c.createBezier(a,b),this.flowChart.mapCanvas.trackingLayer.addShape(c)},_addPortShape:function(a){var b=this.flowChart.portShape;b.points[0].x=a.x,b.points[0].y=a.y,b.updateBound(),this.startPort.type==="IN"?b.symbol=this.flowChart.mapCanvas.getAttribute(i.InPortSel):b.symbol=this.flowChart.mapCanvas.getAttribute(i.OutPortSel),this.flowChart.mapCanvas.trackingLayer.addShape(b)},_isMatchedPort:function(a){for(var b=0;b<this.matchedPorts.length;b++)if(a===this.matchedPorts[b].port)return!0;return!1},_getMatchedPorts:function(a){var c,d=this.flowChart.getNodeCount();for(c=1;c<=d;c++){var e=this.flowChart.nodeItem(c),f,g=e.getMatchedPorts(a);while((f=g.pop())!==b)this.matchedPorts.push(new k.TrackingLink.MatchPortState(f))}},_addMatchedShapes:function(){for(var a=0;a<this.matchedPorts.length;a++)this.flowChart.mapCanvas.trackingLayer.addShape(this.matchedPorts[a].portShape)},_clearPorts:function(){this.startPort=null;var a;while((a=this.matchedPorts.pop())!==b)a.restore();this.flowChart.mapCanvas.trackingLayer.removeAll(),this.flowChart.mapCanvas.trackingLayer.updateBound()},isTracking:function(){return __not_null(this.startPort)},getStartPos:function(){return this.startPort.getPosition(this.flowChart.mapCanvas)},tracking:function(a){var b=this.getStartPos(),c=this.flowChart.mapCanvas.toMapPoint(b.x,b.y),d=this.flowChart.mapCanvas.toMapPoint(a._x,a._y);this.flowChart.mapCanvas.trackingLayer.removeAll(),this._addLinkShape(c,d),this._addPortShape(c),this._addMatchedShapes(),this.flowChart.mapCanvas.trackingLayer.updateBound(),this.flowChart.mapCanvas.refreshTrackingLayer()},start:function(a,b){var c=b.tag;__not_null(c.getNextLink())||(this._getMatchedPorts(c),this.startPort=c)},end:function(a,b){var c=this.startPort,d=b.tag,e=this._isMatchedPort(d);this._clearPorts();if(e){var f=this.flowChart.addLink(c,d);e=__not_null(f)}this.flowChart.mapCanvas.refresh(e)},abort:function(){__not_null(this.startPort)&&(this._clearPorts(),this.flowChart.mapCanvas.refresh(!1))}},k.LinkCutter=function(a){this.flowChart=a,this.link=null,this.cutter=new esri2.Map.Shape(this),this.cutter.visible=!1,this.cutter.createPoint(0,0),this.cutter.symbol=new esri2.Map.Symbol(i.LinkCutter,this.cutter);var b=i.createIconRect(this.cutter.symbol,this.cutter.symbol,i.LinkCutter,this.flowChart.imagesLib.getImage(i.LinkCutter),this.flowChart.imagesLib.getImage(i.LinkCutter),!1,null,i.CutterSize,i.CutterSize);this.cutter.symbol.addShape(b),this.cutter.symbol.symbolUnit.baseY=this.cutter.symbol.symbolUnit.baseX=20,this.cutter.symbol.updateBound()},k.LinkCutter.TimeOutMSec=2e3,k.LinkCutter.hide=function(a,b){a.visible=!1,b.refreshTrackingLayer(a)},k.LinkCutter.__hide=function(a,b){return function(){k.LinkCutter.hide(a,b)}},k.LinkCutter.prototype={onClick:function(a,b){if(this.cutter.visible){this.cutter.visible=!1;var c=this.cutter.bound.rect,d=b.toViewPos(c.xmin,c.ymin),e=b.toViewPos(c.xmax,c.ymax);c=new esri2.Common.RectType(d.x,e.y,e.x,e.y),c.xmax+=i.CutterSize,c.ymax+=i.CutterSize;var f=this.cutter.symbol.symbolUnit;c.offset(-f.baseX,-f.baseY);if(c.ptInRect(a._x,a._y)){var g=this.link;this.link=null,this.flowChart.cutLink(g),this.flowChart.linkLayer.updateBound(),b.refresh(!0);return!0}b.refreshTrackingLayer(this.cutter)}return!1},show:function(a,b,c){this.cutter.visible===!1&&(this.link=c,this.cutter.visible=!0,this.cutter.points[0]=b.toMapPoint(a._x,a._y),this.cutter.updateBound(),__is_null(b.trackingLayer.findShape(this.cutter))&&(b.trackingLayer.addShape(this.cutter),b.trackingLayer.updateBound()),b.refreshTrackingLayer(this.cutter),setTimeout(k.LinkCutter.__hide(this.cutter,b),k.LinkCutter.TimeOutMSec))}};var l=function(a,b,c){this._init(a,b,c)};l.DefaultStatus="",l.InitializedStatus="initialized",l.SucceededStatus="succeeded",l.FailedStatus="failed",l.RunningStatus="running",l.PausedStatus="paused",l.create=function(a,b,c,d,e){var f=new l(a,c,d);switch(b){case i.NodeAssignment:o.create(f,e);break;case i.NodeDispatch:q.create(f,e);break;case i.NodeGeometry:s.create(f,e);break;case i.NodeFeature:r.create(f,e);break;case i.NodeGpAsync:t.create(f,e);break;case i.NodeGpSync:u.create(f,e);break;case i.NodeDefaultVal:p.create(f,e);break;case i.NodePubInput:v.create(f,e);break;case i.NodePubOutput:w.create(f,e)}if(__is_null(f.typedNode))throw new Error("GeoNode.create: invalid node type: "+b);return f},l.EditState=function(a){this.currentNode=a,this.nodeURL=this.nodeJSON=null,this.execStatus=l.DefaultStatus,this.errMessage=""},l.EditState.prototype.isValid=function(){return __not_null(this.currentNode)},l.EditState.prototype.update=function(){this.currentNode.updateState(this)},l.prototype={_init:function(a,b,c){this.id=a,this.tagShape=b,this.tagShape.tag=this,this.flowChart=c,this.typedNode=null,this.name="",this.displayName=this.name,this.url="",this.execStatus=l.DefaultStatus,this.errMessage="",this.inports=new esri2.Common.PairArray,this.outports=new esri2.Common.PairArray,this.inports.insert("-1",null),this.outports.insert("-1",null),this.serviceName="",this.serviceStates={},this.validateResult=""},toString:function(){return"GeoNode class"},getTypeName:function(){return this.isValid()?this.typedNode.toString():"Undefined"},isDefaultStatus:function(){return this.execStatus===l.DefaultStatus},getStatusColor:function(){switch(this.execStatus){case l.InitializedStatus:return"#6AE8DB";case l.SucceededStatus:return"#34B14C";case l.FailedStatus:return"#ED1C24";case l.RunningStatus:return"#00A2E8";case l.PausedStatus:return"#FF7F27";default:return"#888"}},getTitle:function(){return this.getTypeName()+" Node ("+this.id+") - "+this.typedNode.getDisplayName()},setServiceState:function(a,b){this.serviceName=a,this.serviceStates[this.serviceName]=b},getServiceState:function(){var a=this.serviceStates[this.serviceName];__is_null(a)&&(a="");return a},isValid:function(){return __not_null(this.typedNode)},getInPort:function(a){if(__is_null(a))return this.inports.size()-1;if(a<1||a>=this.inports.size())return null;return this.inports.getVal(a)},getOutPort:function(a){if(__is_null(a))return this.outports.size()-1;if(a<1||a>=this.outports.size())return null;return this.outports.getVal(a)},getInPortById:function(a){var b=this.inports.find(a);if(b!==f)return this.inports.getVal(b);return null},getOutPortById:function(a){var b=this.outports.find(a);if(b!==f)return this.outports.getVal(b);return null},updateState:function(a){this.typedNode.parseNodeJSON(a.nodeJSON)?(__log("GeoNode.updateState: init drawing node by json"),this.name=a.nodeJSON.name,this.execStatus=l.DefaultStatus,this.displayName=a.nodeJSON.displayName,this.url=a.nodeURL,this.updatePorts(a.nodeJSON)):(__log("GeoNode.updateState: update drawing node by status"),this.execStatus=a.execStatus,this.errMessage=a.errMessage,i.updateNodeRenders(this,i.OutRender))},createPort:function(a,b,c){var d=new m(b.id,c,a,this);d.displayName=b.displayName,d.required=b.required,d.dataType=b.type,d.defaultValue=__is_null(b.defaultValue)?"":b.defaultValue,c==="IN"?this.inports.insert(d.id,d):this.outports.insert(d.id,d);return d},removePort:function(a){if(this.isValid())if(this.typedNode.removePort(a))return;a.type==="IN"?this.inports.erase(a.id):this.outports.erase(a.id)},clearPorts:function(){var a;while(this.inports.size()>1)a=this.inports.eraseAt(1);while(this.outports.size()>1)this.outports.eraseAt(1)},updatePorts:function(a){this.clearPorts(),this.removeLinks(this.getAllLinks());for(var b=0;b<a.parameters.length;b++)m.create(this,a.parameters[b]);this.typedNode.updatePorts()},getFromNodeLinks:function(){var a,b=[],c=this.flowChart.__links,d=c.size();while(d-->1)a=c.getVal(d),a.fromNode===this&&b.push(a);return b},getToNodeLinks:function(){var a,b=[],c=this.flowChart.__links,d=c.size();while(d-->1)a=c.getVal(d),a.toNode===this&&b.push(a);return b},getAllLinks:function(){var a,b=[],c=this.flowChart.__links,d=c.size();while(d-->1)a=c.getVal(d),(a.fromNode===this||a.toNode===this)&&b.push(a);return b},removeLinks:function(a,c){var d;while((d=a.pop())!==b)this.flowChart.cutLink(d);c!==!0&&this.flowChart.linkLayer.updateBound()},toJsonString:function(){return this.typedNode.toJsonString()},getMatchedPorts:function(a){var b=[];if(a.parentNode.id===this.id)return b;var c,d,e,f,g;if(a.type==="IN"){f=this.getTypeName(),g=a.parentNode.getTypeName();if(i.getMatchTable(f,g)===0){__log("Nodes not matched: ",f," !=> ",g);return b}for(d=this.getOutPort(),c=1;c<=d;c++)e=this.getOutPort(c),e.matchPort(a)&&b.push(e)}else if(a.type==="OUT"){g=this.getTypeName(),f=a.parentNode.getTypeName();if(i.getMatchTable(f,g)===0){__log("Nodes not matched: ",f," !=> ",g);return b}for(d=this.getInPort(),c=1;c<=d;c++)e=this.getInPort(c),e.matchPort(a)&&b.push(e)}return b},validate:function(){this.validateResult="";if(!this.isValid()){this.validateResult="not a valid node";throw new Error(this.validateResult)}var a=this.getAllLinks();if(a.length===0){this.validateResult="no links found with node "+this.id+": "+this.displayName;throw new Error(this.validateResult)}var b,c,d=this.getInPort();for(c=1;c<=d;c++)b=this.getInPort(c),b.validate();for(d=this.getOutPort(),c=1;c<=d;c++)b=this.getOutPort(c),b.validate()}};var m=function(a,b,c,d){this._init(a,b,c,d)};m.DirectionInput="esriGPParameterDirectionInput",m.DirectionOutput="esriGPParameterDirectionOutput",m.ParameterRequired="esriGPParameterTypeRequired",m.ParameterOptional="esriGPParameterTypeOptional",m.create=function(a,b){if(b.direction===m.DirectionInput){if(a.inports.size()>i.MaxPorts)throw new Error("GeoPort.create: exceed max inports: "+i.MaxPorts);var c=new m(b.name,"IN",b.name,a);c.setData(b),a.inports.insert(c.id,c);return c}if(b.direction===m.DirectionOutput){if(a.outports.size()>i.MaxPorts)throw new Error("GeoPort.create: exceed max outports: "+i.MaxPorts);var d=new m(b.name,"OUT",b.name,a);d.setData(b),a.outports.insert(d.id,d);return d}throw new Error("GeoPort.create: invalid port type: "+b.direction)},m.prototype={_init:function(a,b,c,d){this.id=a,this.type=b,this.name=c,this.displayName=this.name,this.required=!1,this.parentNode=d,this.tagShape=null,this.links={},this.validateResult=this.defaultValue=this.dataType=""},getTypeId:function(){return this.type+":"+this.id},setData:function(a){this.displayName=a.displayName,this.description=__not_null(a.description)?a.description:"",this.dataType=a.dataType,this.defaultValue=a.defaultValue,this.required=a.parameterType===m.ParameterRequired?!0:!1;if(__not_null(this.defaultValue))try{var b=JSON.stringify(this.defaultValue);__log("===",this.displayName,b),b.length>0&&(this.required=!1)}catch(c){__log("GeoPort.setData(): Invalid JSON object.")}},isValid:function(){return!0},toString:function(){return"GeoPort class"},getNextLink:function(a){var b,c=a;for(b in this.links)if(this.links.hasOwnProperty(b)){if(__is_null(c))return this.links[b];b===a.id&&(c=null)}return null},getLinkedPort:function(){var a=this.getNextLink();if(__not_null(a)){if(this===a.fromPort)return a.toPort;if(this===a.toPort)return a.fromPort;throw new Error("GeoPort.getLinkedPort(): Critical Error. should never run to this")}return null},attachLink:function(a){this.links[a.id]=a},detachLink:function(a){delete this.links[a.id],this.links=[]},getPosition:function(a){var b=this.parentNode.tagShape.item(0),c=a.toViewPos(b.x,b.y),d=this.tagShape.item(0).spawn();d.offset(c.x,c.y);return d},getPoint:function(a){var b=this.getPosition(a);return a.toMapPoint(b.x,b.y)},setPoint:function(a){var b=this.getPosition(a),c=a.toMapPoint(b.x,b.y);this.tagShape.item(0).x=c.x,this.tagShape.item(0).y=c.y},getIconShape:function(){var a=this.parentNode.typedNode.getNodeSymbol();return a.getAttribute(this.getTypeId())},matchPort:function(a){if(__not_null(this.getNextLink()))return!1;if(__is_empty(a.dataType)||__is_empty(this.dataType))return!0;if(a.dataType===this.dataType)return!0;if(a.dataType==="GPFeatureRecordSetLayer"&&this.dataType==="Geometries"||this.dataType==="GPFeatureRecordSetLayer"&&a.dataType==="Geometries")return!0;if(a.dataType!==this.dataType){__log("port dataTypes not matched: ",a.dataType,this.dataType);return!1}return!0},validate:function(){this.validateResult="";var a=this.getNextLink();if(this.required)if(__is_null(a)){this.validateResult="A required port "+this.getTypeId()+" (node "+this.parentNode.id+": "+this.parentNode.displayName+") has no link found";throw new Error(this.validateResult)}},getDefaultValueJson:function(){var a="";if(__is_null(this.defaultValue))a=h(a);else{if(typeof this.defaultValue==="object")return a=JSON.stringify(this.defaultValue);if(typeof this.defaultValue==="number")a=h(this.defaultValue);else{try{return a=JSON.stringify(JSON.parse(this.defaultValue))}catch(b){}a=this.defaultValue+"",a=a.replace(/\"/g,""),a=h(a)}}return a},toJsonString:function(){var a="";a+=g+g+g,a+=h(this.name),a+=":{\n",a+=g+g+g+g,a+=h("id"),a+=":",a+=h(this.id),a+=",\n",a+=g+g+g+g,a+=h("displayName"),a+=":",a+=h(this.displayName),a+=",\n",a+=g+g+g+g,a+=h("description"),a+=":",a+=h(this.description),a+=",\n",a+=g+g+g+g,a+=h("type"),a+=":",a+=h(this.dataType),a+=",\n",a+=g+g+g+g,a+=h("required"),a+=":",a+=this.required,a+=",\n",a+=g+g+g+g,a+=h("defaultValue"),a+=":",a+=this.getDefaultValueJson(),a+="\n",a+=g+g+g;return a+="}"}};var n=function(a,b,c){this._init(a,b,c)};n.create=function(a,b,c){if(__is_null(b)||__is_null(c)||b===c)return null;if(b.type===c.type){__log("GeoLink.create failed: port types are same");return null}if(__not_null(b.getNextLink())){__log("GeoLink.create failed: fromPort has link");return null}if(__not_null(c.getNextLink())){__log("GeoLink.create failed: toPort has link");return null}if(b.parentNode===c.parentNode){__log("GeoLink.create failed: cannot link node to itself");return null}return b.type==="IN"?new n(a,c,b):new n(a,b,c)},n.removeFromLayer=function(a,b){a.removeAt(b.tagShape),a.removeAt(b.fromPtShape),a.removeAt(b.toPtShape)},n.insertIntoLayer=function(a,b){a.addShapes(b.tagShape,b.toPtShape,b.fromPtShape)},n.prototype._init=function(a,b,c){this.id=a,this.fromPort=b,this.fromNode=b.parentNode,this.fromPort.attachLink(this),this.toPort=c,this.toNode=c.parentNode,this.toPort.attachLink(this),this.tagShape=null,this.fromPtShape=new esri2.Map.Shape,this.toPtShape=new esri2.Map.Shape},n.prototype.toString=function(){return"GeoLink class"},n.prototype.isValid=function(){return __not_null(this.tagShape)},n.prototype.detachPorts=function(){this.fromPort.detachLink(this),this.toPort.detachLink(this)},n.prototype.update=function(a){var b=this.fromPort.getPoint(a),c=this.toPort.getPoint(a);__is_null(this.tagShape)&&(this.tagShape=new esri2.Map.Shape),b.x>c.x?this.tagShape.createBezier(b,c,new esri2.Map.Point(b.x,c.y),new esri2.Map.Point(c.x,b.y)):this.tagShape.createBezier(b,c),this.tagShape.tag=this,this.fromPtShape.createPoint(b.x,b.y,0),this.toPtShape.createPoint(c.x,c.y,0),this.fromPtShape.symbol=a.getAttribute(i.OutPortLinked),this.toPtShape.symbol=a.getAttribute(i.InPortLinked);return this.tagShape},n.prototype.ignoredNode=function(){if(!this.isValid())return!0;var a=this.fromNode.getTypeName(),b=this.toNode.getTypeName(),c=a===i.NodeDefaultVal||a===i.NodePubInput||a===i.NodePubOutput||b===i.NodeDefaultVal||b===i.NodePubInput||b===i.NodePubOutput;return c},n.prototype.toJsonString=function(){var a="";a+=g,a+="{\n",a+=g+g,a+=h("fromKnotId"),a+=":",a+=h(this.fromNode.id),a+=",\n",a+=g+g,a+=h("fromPortName"),a+=":",a+=h(this.fromPort.name),a+=",\n",a+=g+g,a+=h("toKnotId"),a+=":",a+=h(this.toNode.id),a+=",\n",a+=g+g,a+=h("toPortName"),a+=":",a+=h(this.toPort.name),a+="\n",a+=g;return a+="}"};var o=function(a){this._init(a)};o.create=function(a,b){var c=new o(a);__not_null(b)&&(c.description=__base64.decode(b.description),__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState))),c.updatePorts();return c},o.ExecutionType="esriExecutionTypeAssignment",o.DefaultNodeHeight=i.GridSize*3,o.DefaultNodeWidth=i.GridSize*6,o.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=o.DefaultNodeHeight,this.nodW=o.DefaultNodeWidth,this.description="",i.initNodeDrawing(this.node)},toString:function(){return i.NodeAssignment},getDisplayName:function(){return i.NodeAssignment},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;return!0},removePort:function(a){a.dataType="";return!0},updateOutPort:function(a,b){a.fromPort.dataType=a.toPort.dataType},updatePorts:function(){var a,b,c=this.getNodeSymbol();b=new m("user","IN","user",this.node),b.dataType="",b.required=!0,this.node.inports.insert(b.id,b),i.createInPort(this.flowChart,c,b,this.nodW,1),a=new m("Output","OUT","Output",this.node),a.dataType="",a.required=!0,this.node.outports.insert(a.id,a),i.createOutPort(this.flowChart,c,a,this.nodW,1),this.nodH=3*i.GridSize,i.updateDrawNode(c,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a,b=0,c=null,d="";d+=g,d+=h(this.node.id),d+=":{\n",d+=g+g,d+=h("name"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("type"),d+=":",d+=h(this.toString()),d+=",\n",d+=g+g,d+=h("description"),d+=":",d+=h(__base64.encode(this.description)),d+=",\n",d+=g+g,d+=h("nodeServiceName"),d+=":",d+=h(__base64.encode(this.node.serviceName)),d+=",\n",d+=g+g,d+=h("nodeServiceState"),d+=":",d+=h(__base64.encode(this.node.getServiceState())),d+=",\n";var e=this.node.tagShape.points[0],f=this.node.flowChart.mapCanvas.toViewPos(e.x,e.y);for(d+=g+g,d+=h("posX"),d+=":",d+=h(f.x.toFixed(0)),d+=",\n",d+=g+g,d+=h("posY"),d+=":",d+=h(f.y.toFixed(0)),d+=",\n",d+=g+g,d+=h("typeProperties"),d+=":{\n",d+=g+g+g,d+=h("url"),d+=":",d+=h(this.node.url),d+="\n",d+=g+g,d+="},\n",d+=g+g,d+=h("inputPorts"),d+=":{\n",b=this.node.inports.size(),a=1;a<b;a++)c=this.node.getInPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");for(d+=g+g,d+="},\n",d+=g+g,d+=h("outputPorts"),d+=":{\n",b=this.node.outports.size(),a=1;a<b;a++)c=this.node.getOutPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");d+=g+g,d+="}\n",d+=g;return d+="}"}};var p=function(a){this._init(a)};p.create=function(a,b){var c=new p(a);if(__not_null(b)){var d=b[0];a.name=d.name,a.displayName=d.name,__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState))}c.updatePorts(b);return c},p.ExecutionType="esriExecutionTypeInternalValue",p.DefaultNodeHeight=i.GridSize*3,p.DefaultNodeWidth=i.GridSize*6,p.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=p.DefaultNodeHeight,this.nodW=p.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeDefaultVal},getDisplayName:function(){return"Default Values"},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;return!0},removePort:function(a){var b,c=this.getNodeSymbol(),d=this.node.outports.size();while(d-->1){if((b=this.node.getOutPort(d))===a){this._removePortShapes(c,a);break}this._offsetPortShapes(c,b,0,-i.GridSize)}this.node.outports.erase(a.id),c.updateBound(),this.nodH=(this.node.outports.size()+1)*i.GridSize,i.updateDrawNode(c,this.nodW,this.nodH,this.getDisplayName());return!0},updatePorts:function(a){if(__is_null(a))this.addNewPort();else for(var b=0,c;b<a.length;b++){c=a[b];var d=this.addNewPort(c.portName);typeof c.value==="object"?d.defaultValue=JSON.stringify(c.value):d.defaultValue=c.value;var e=this.flowChart.getNodeById(c.knotId),f=e.getInPortById(c.portName);__not_null(f)&&this.flowChart.addLink(d,f,b<a.length-1?!1:!0)}},addNewPort:function(a){var c=this.getNodeSymbol(),d=this.node.outports.size(),e=new m(this.node.outports.genKey(),"OUT",a===b?"":a,this.node);e.required=!1,this.node.outports.insert(e.id,e),i.createOutPort(this.flowChart,c,e,this.nodW,d),this.nodH=(d+2)*i.GridSize,i.updateDrawNode(c,this.nodW,this.nodH,this.getDisplayName());return e},updateOutPort:function(a,b){a.fromPort.name=a.toPort.name,a.fromPort.displayName=a.toPort.displayName,a.fromPort.dataType=a.toPort.dataType,this.updatePortText(a.fromPort),b===!0&&this.addNewPort()},updatePortText:function(a){var b,c=this.getNodeSymbol(),d=c.shapes.length;while(d-->0)b=c.shapes[d],b.tag===a&&(b.getAttribute("PORT_TEXT")===!0&&b.addAttribute("TEXT",a.defaultValue))},_removePortShapes:function(a,b){var c,d=a.shapes.length;while(d-->0)c=a.shapes[d],c.tag===b&&a.removeAt(d)},_offsetPortShapes:function(a,b,c,d){var e,f=a.shapes.length;while(f-->0)e=a.shapes[f],e.tag===b&&e.offset(c,d);var g=null;while((g=b.getNextLink(g))!==null)g.update(this.flowChart.mapCanvas);this.flowChart.linkLayer.updateBound()},isValid:function(){for(var a,b,c=1,d=this.node.getOutPort();c<=d;c++){a=this.node.getOutPort(c),b=a.getNextLink();if(__not_null(b))return!0}return!1},toJsonString:function(){for(var a="",b,c,d=1,e=this.node.getOutPort();d<=e;d++){b=this.node.getOutPort(d),c=b.getNextLink();if(__not_null(c)){a[a.length-1]==="}"&&(a+=",\n"),a+=g,a+="{\n",a+=g+g,a+=h("id"),a+=":",a+=h(this.node.id),a+=",\n",a+=g+g,a+=h("name"),a+=":",a+=h(this.node.displayName),a+=",\n",a+=g+g,a+=h("nodeServiceName"),a+=":",a+=h(__base64.encode(this.node.serviceName)),a+=",\n",a+=g+g,a+=h("nodeServiceState"),a+=":",a+=h(__base64.encode(this.node.getServiceState())),a+=",\n";var f=this.node.tagShape.points[0],i=this.node.flowChart.mapCanvas.toViewPos(f.x,f.y);a+=g+g,a+=h("posX"),a+=":",a+=h(i.x.toFixed(0)),a+=",\n",a+=g+g,a+=h("posY"),a+=":",a+=h(i.y.toFixed(0)),a+=",\n",a+=g+g,a+=h("knotId"),a+=":",a+=h(c.toNode.id),a+=",\n",a+=g+g,a+=h("portName"),a+=":",a+=h(c.toPort.name),a+=",\n",a+=g+g,a+=h("value"),a+=":",a+=c.fromPort.getDefaultValueJson(),a+="\n",a+=g,a+="}"}}return a}};var q=function(a){this._init(a)};q.create=function(a,b){var c=new q(a);if(__not_null(b)){a.name=b.name,a.displayName=a.name;var d,e;for(d in b.inputPorts)e=b.inputPorts[d],a.createPort(d,e,"IN");for(d in b.outputPorts)e=b.outputPorts[d],a.createPort(d,e,"OUT");__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState))}c.updatePorts(b);return c},q.ExecutionType="esriExecutionTypeDispatch",q.DefaultNodeHeight=i.GridSize*3,q.DefaultNodeWidth=i.GridSize*6,q.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=q.DefaultNodeHeight,this.nodW=q.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeDispatch},getDisplayName:function(){return"Dispatch"},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;if(a.type!==i.NodeDispatch)return!1;return!0},updatePorts:function(a){var b=this.getNodeSymbol();if(__is_null(a)){var c=new m("0","IN","0",this.node);c.required=!0,c.displayName="",this.node.inports.insert(c.id,c),i.createInPort(this.flowChart,b,c,this.nodW,1),this.addNewPort()}else{for(var d=this.node.getInPort(),e=this.node.getOutPort(),f=1,g=1,h;f<=d;f++)h=this.node.getInPort(f),i.createInPort(this.flowChart,b,h,this.nodW,g++);for(f=1,--g;f<=e;f++)h=this.node.getOutPort(f),i.createOutPort(this.flowChart,b,h,this.nodW,g++);this.addNewPort()}},addNewPort:function(){var a=this.getNodeSymbol(),b=this.node.outports.genKey(),c=new m(b,"OUT",b,this.node);c.required=!1,c.displayName="";var d=this.node.outports.size();this.node.outports.insert(c.id,c),i.createOutPort(this.flowChart,a,c,this.nodW,d),this.nodH=(d+2)*i.GridSize,i.updateDrawNode(a,this.nodW,this.nodH,this.getDisplayName());return c},updateInPort:function(a,b){b?(a.toPort.displayName=a.fromPort.displayName,a.toPort.dataType=a.fromPort.dataType):a.toPort.dataType=a.toPort.displayName="",this.updatePortText(a.toPort)},updateOutPort:function(a,b){a.fromPort.displayName=a.toPort.name,a.fromPort.dataType=a.toPort.dataType,this.updatePortText(a.fromPort),b===!0&&this.addNewPort()},updatePortText:function(a){var b,c=this.getNodeSymbol(),d=c.shapes.length;while(d-->0)b=c.shapes[d],b.tag===a&&(b.getAttribute("PORT_TEXT")===!0&&b.addAttribute("TEXT",a.displayName))},_removePortShapes:function(a,b){var c,d=a.shapes.length;while(d-->0)c=a.shapes[d],c.tag===b&&a.removeAt(d)},_offsetPortShapes:function(a,b,c,d){var e,f=a.shapes.length;while(f-->0)e=a.shapes[f],e.tag===b&&e.offset(c,d);var g=null;while((g=b.getNextLink(g))!==null)g.update(this.flowChart.mapCanvas);this.flowChart.linkLayer.updateBound()},removePort:function(a){if(a.type==="IN")return c;var b,d=this.getNodeSymbol(),e=this.node.outports.size();while(e-->1){if((b=this.node.getOutPort(e))===a){this._removePortShapes(d,a);break}this._offsetPortShapes(d,b,0,-i.GridSize)}this.node.outports.erase(a.id),d.updateBound(),this.nodH=(this.node.outports.size()+1)*i.GridSize,i.updateDrawNode(d,this.nodW,this.nodH,this.getDisplayName());return!0},toJsonString:function(){var a="";a+=g,a+=h(this.node.id),a+=":{\n",a+=g+g,a+=h("name"),a+=":",a+=h(this.getDisplayName()),a+=",\n",a+=g+g,a+=h("type"),a+=":",a+=h(this.node.getTypeName()),a+=",\n",a+=g+g,a+=h("nodeServiceName"),a+=":",a+=h(__base64.encode(this.node.serviceName)),a+=",\n",a+=g+g,a+=h("nodeServiceState"),a+=":",a+=h(__base64.encode(this.node.getServiceState())),a+=",\n";var b=this.node.tagShape.points[0],c=this.node.flowChart.mapCanvas.toViewPos(b.x,b.y);a+=g+g,a+=h("posX"),a+=":",a+=h(c.x.toFixed(0)),a+=",\n",a+=g+g,a+=h("posY"),a+=":",a+=h(c.y.toFixed(0)),a+=",\n",a+=g+g,a+=h("typeProperties"),a+=": {\n",a+=g+g,a+="},\n",a+=g+g,a+=h("inputPorts"),a+=":{\n";var d,e,f=this.node.inports.size();for(d=1;d<f;d++)e=this.node.getInPort(d),e.isValid()&&(a+=e.toJsonString(d-1),d===f-1?a+="\n":a+=",\n");for(a+=g+g,a+="},\n",a+=g+g,a+=h("outputPorts"),a+=":{\n",f=this.node.outports.size()-1,d=1;d<f;d++)e=this.node.getOutPort(d),e.isValid()&&(a+=e.toJsonString(e.id),d===f-1?a+="\n":a+=",\n");a+=g+g,a+="}\n",a+=g;return a+="}"}};var r=function(a){this._init(a)};r.create=function(a,b){var c=new r(a);if(__not_null(b)){var d,e,f;a.url=b.typeProperties.url,a.name=b.name,__not_empty(b.displayName)?a.displayName=b.displayName:a.displayName=a.name;for(e in b.inputPorts)d=b.inputPorts[e],f=a.createPort(e,d,"IN");for(e in b.outputPorts)d=b.outputPorts[e],f=a.createPort(e,d,"OUT");__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState)),c.updatePorts()}return c},r.ExecutionType="esriExecutionTypeFeature",r.DefaultNodeHeight=i.GridSize*3,r.DefaultNodeWidth=i.GridSize*6,r.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=s.DefaultNodeHeight,this.nodW=s.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeFeature},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;if(a.executionType!==r.ExecutionType)throw new Error("Feature.parseNodeJSON failed: "+r.ExecutionType+" mismatched with "+a.executionType);return!0},removePort:function(a){return!0},updatePorts:function(){var a=this.getNodeSymbol(),b,c=a.shapes.length;while(c-->0)b=a.shapes[c],b.getAttribute("port:symbol")===a&&a.removeAt(c);for(var d=this.node.getInPort(),e=this.node.getOutPort(),f=1,g=1,h;f<=d;f++)h=this.node.getInPort(f),i.createInPort(this.flowChart,a,h,this.nodW,g++);for(f=1;f<=e;f++)h=this.node.getOutPort(f),i.createOutPort(this.flowChart,a,h,this.nodW,g++);this.nodH=(d+e+2)*i.GridSize,i.updateDrawNode(a,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a,b=0,c=null,d="";d+=g,d+=h(this.node.id),d+=":{\n",d+=g+g,d+=h("name"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("displayName"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("type"),d+=":",d+=h(this.toString()),d+=",\n",d+=g+g,d+=h("nodeServiceName"),d+=":",d+=h(__base64.encode(this.node.serviceName)),d+=",\n",d+=g+g,d+=h("nodeServiceState"),d+=":",d+=h(__base64.encode(this.node.getServiceState())),d+=",\n";var e=this.node.tagShape.points[0],f=this.node.flowChart.mapCanvas.toViewPos(e.x,e.y);for(d+=g+g,d+=h("posX"),d+=":",d+=h(f.x.toFixed(0)),d+=",\n",d+=g+g,d+=h("posY"),d+=":",d+=h(f.y.toFixed(0)),d+=",\n",d+=g+g,d+=h("typeProperties"),d+=":{\n",d+=g+g+g,d+=h("url"),d+=":",d+=h(this.node.url),d+=",\n",d+=g+g+g,d+=h("operation"),d+=":",d+=h(this.node.name),d+="\n",d+=g+g,d+="},\n",d+=g+g,d+=h("inputPorts"),d+=":{\n",b=this.node.inports.size(),a=1;a<b;a++)c=this.node.getInPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");for(d+=g+g,d+="},\n",d+=g+g,d+=h("outputPorts"),d+=":{\n",b=this.node.outports.size(),a=1;a<b;a++)c=this.node.getOutPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");d+=g+g,d+="}\n",d+=g;return d+="}"}},r.operations={query:{name:"feature",displayName:"Feature",enabled:!0,url:"---replaced by user input---",description:"The query operation is performed on a feature service layer resource. The result of this operation is either a feature set or an array of feature ids",executionType:"esriExecutionTypeFeature",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/fsquery.html",parameters:[{name:"where",dataType:"GPString",displayName:"Where",direction:"esriGPParameterDirectionInput",description:"A where clause for the query filter",parameterType:"esriGPParameterTypeRequired",defaultValue:"1=1"},{name:"geometry",dataType:"GPString",displayName:"Geometry",direction:"esriGPParameterDirectionInput",description:"The geometry to apply as the spatial filter",parameterType:"esriGPParameterTypeOptional",defaultValue:""},{name:"geometryType",dataType:"GPString",displayName:"Geometry Type",direction:"esriGPParameterDirectionInput",description:"The type of geometry specified by the geometry parameter",parameterType:"esriGPParameterTypeOptional",defaultValue:"esriGeometryEnvelope"},{name:"inSR",dataType:"GPString",displayName:"In Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The spatial reference of the input geometry",parameterType:"esriGPParameterTypeOptional",defaultValue:""},{name:"outSR",dataType:"GPString",displayName:"Out Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The spatial reference of the returned geometry",parameterType:"esriGPParameterTypeOptional",defaultValue:""},{name:"spatialRel",dataType:"GPString",displayName:"Spatial Relationship",direction:"esriGPParameterDirectionInput",description:"The spatial relationship to be applied on the input geometry while performing the query",parameterType:"esriGPParameterTypeOptional",defaultValue:"esriSpatialRelIntersects"},{name:"outFields",dataType:"GPString",displayName:"Out Fields",direction:"esriGPParameterDirectionInput",description:"The list of fields to be included in the returned resultset",parameterType:"esriGPParameterTypeRequired",defaultValue:"*"},{name:"result",dataType:"GPFeatureRecordSetLayer",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Output result",parameterType:"esriGPParameterTypeOptional"}]}};var s=function(a){this._init(a)};s.create=function(a,b){var c=new s(a);if(__not_null(b)){var d,e,f;a.displayName=b.name,a.url=b.typeProperties.url,a.name=b.typeProperties.operation;for(e in b.inputPorts)d=b.inputPorts[e],f=a.createPort(e,d,"IN");for(e in b.outputPorts)d=b.outputPorts[e],f=a.createPort(e,d,"OUT");__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState)),c.updatePorts()}return c},s.ExecutionType="esriExecutionTypeGeometry",s.DefaultNodeHeight=i.GridSize*3,s.DefaultNodeWidth=i.GridSize*6,s.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=s.DefaultNodeHeight,this.nodW=s.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeGeometry},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;if(a.executionType!==s.ExecutionType)throw new Error("Geometry.parseNodeJSON failed: "+s.ExecutionType+" mismatched with "+a.executionType);return!0},removePort:function(a){return!0},updatePorts:function(){var a=this.getNodeSymbol(),b,c=a.shapes.length;while(c-->0)b=a.shapes[c],b.getAttribute("port:symbol")===a&&a.removeAt(c);for(var d=this.node.getInPort(),e=this.node.getOutPort(),f=1,g=1,h;f<=d;f++)h=this.node.getInPort(f),i.createInPort(this.flowChart,a,h,this.nodW,g++);for(f=1;f<=e;f++)h=this.node.getOutPort(f),i.createOutPort(this.flowChart,a,h,this.nodW,g++);this.nodH=(d+e+2)*i.GridSize,i.updateDrawNode(a,this.nodW,this.nodH,this.getDisplayName())},getGeometryURL:function(){var a=this.node.url.replace("/"+this.node.name,"");return a},toJsonString:function(){var a,b=0,c=null,d="";d+=g,d+=h(this.node.id),d+=":{\n",d+=g+g,d+=h("name"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("type"),d+=":",d+=h(this.toString()),d+=",\n",d+=g+g,d+=h("nodeServiceName"),d+=":",d+=h(__base64.encode(this.node.serviceName)),d+=",\n",d+=g+g,d+=h("nodeServiceState"),d+=":",d+=h(__base64.encode(this.node.getServiceState())),d+=",\n";var e=this.node.tagShape.points[0],f=this.node.flowChart.mapCanvas.toViewPos(e.x,e.y);for(d+=g+g,d+=h("posX"),d+=":",d+=h(f.x.toFixed(0)),d+=",\n",d+=g+g,d+=h("posY"),d+=":",d+=h(f.y.toFixed(0)),d+=",\n",d+=g+g,d+=h("typeProperties"),d+=":{\n",d+=g+g+g,d+=h("url"),d+=":",d+=h(this.getGeometryURL()),d+=",\n",d+=g+g+g,d+=h("operation"),d+=":",d+=h(this.node.name),d+="\n",d+=g+g,d+="},\n",d+=g+g,d+=h("inputPorts"),d+=":{\n",b=this.node.inports.size(),a=1;a<b;a++)c=this.node.getInPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");for(d+=g+g,d+="},\n",d+=g+g,d+=h("outputPorts"),d+=":{\n",b=this.node.outports.size(),a=1;a<b;a++)c=this.node.getOutPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");d+=g+g,d+="}\n",d+=g;return d+="}"}},s.operations={areasAndLengths:{name:"areasAndLengths",displayName:"Areas And Lengths",enabled:!0,description:"This operation calculates areas and perimeter lengths for each polygon specified in the input array",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?areasAndLengths.html",parameters:[{name:"polygons",dataType:"Geometries",displayName:"Polygons",direction:"esriGPParameterDirectionInput",description:"The array of polygons whose areas and lengths are to be computed",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input polygons",parameterType:"esriGPParameterTypeOptional"},{name:"lengthUnit",dataType:"GPString",displayName:"Length Unit",direction:"esriGPParameterDirectionInput",description:"The length unit in which perimeters of polygons will be calculated",parameterType:"esriGPParameterTypeOptional"},{name:"areaUnit",dataType:"GPString",displayName:"Area Unit",direction:"esriGPParameterDirectionInput",description:"The area unit in which areas of polygons will be calculated",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},autoComplete:{name:"autoComplete",displayName:"AutoComplete",enabled:!0,description:"It constructs polygons that fill in the gaps between existing polygons and a set of polylines",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?autoComplete.html",parameters:[{name:"polygons",dataType:"Geometries",displayName:"Polygons",direction:"esriGPParameterDirectionInput",description:"The array of polygons that will provide some boundaries for new polygons",parameterType:"esriGPParameterTypeRequired"},{name:"polylines",dataType:"Geometries",displayName:"Polylines",direction:"esriGPParameterDirectionInput",description:"The array of polygons that will provide some boundaries for new polygons",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input polygons and polylines",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},buffer:{name:"buffer",displayName:"Buffer",enabled:!0,description:"The result of this operation is buffer polygons at the specified distances for the input geometry array",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?buffer.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be buffered",parameterType:"esriGPParameterTypeRequired"},{name:"inSR",dataType:"GPString",displayName:"In Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"outSR",dataType:"GPString",displayName:"Out Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the returned geometries",parameterType:"esriGPParameterTypeOptional"},{name:"bufferSR",dataType:"GPString",displayName:"Buffer Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object in which the geometries are buffered",parameterType:"esriGPParameterTypeOptional"},{name:"distances",dataType:"GPString",displayName:"Distances",direction:"esriGPParameterDirectionInput",description:"The distances the input geometries are buffered",parameterType:"esriGPParameterTypeRequired"},{name:"unit",dataType:"GPString",displayName:"unit",direction:"esriGPParameterDirectionInput",description:"The units for calculating each buffer distance",parameterType:"esriGPParameterTypeOptional"},{name:"unionResults",dataType:"GPBoolean",displayName:"Union Results",direction:"esriGPParameterDirectionInput",description:"If true, all geometries buffered at a given distance are unioned into a single (possibly multipart) polygon, and the unioned geometry is placed in the output array",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},convexHull:{name:"convexHull",displayName:"ConvexHull",enabled:!0,description:"The convexHull operation returns the convex hull of the input geometry",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?convexHull.html",parameters:[{name:"polygons",dataType:"Geometries",displayName:"Polygons",direction:"esriGPParameterDirectionInput",description:"The geometries whose convex hull is to be created",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the output geometry",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},cut:{name:"cut",displayName:"Cut",enabled:!0,description:"This operation splits the input polyline or polygon where it crosses a cutting polyline",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?cut.html",parameters:[{name:"cutter",dataType:"Geometries",displayName:"Cutter",direction:"esriGPParameterDirectionInput",description:"The polyline that will be used to divide the target into pieces where it crosses the target",parameterType:"esriGPParameterTypeRequired"},{name:"target",dataType:"Geometries",displayName:"Target",direction:"esriGPParameterDirectionInput",description:"The array of polylines/polygons to be cut",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometry",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},densify:{name:"densify",displayName:"Densify",enabled:!0,description:"This operation densifies geometries by plotting points between existing vertices",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?densify.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be densified",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input polylines",parameterType:"esriGPParameterTypeOptional"},{name:"maxSegmentLength",dataType:"GPString",displayName:"Max Segment Length",direction:"esriGPParameterDirectionInput",description:"All segments longer than maxSegmentLength are replaced with sequences of lines no longer than maxSegmentLength",parameterType:"esriGPParameterTypeOptional"},{name:"geodesic",dataType:"GPString",displayName:"Max Segment Length",direction:"esriGPParameterDirectionInput",description:"A flag that can be set to true if GCS spatial references are used or densify geodesic is to be performed",parameterType:"esriGPParameterTypeOptional"},{name:"lengthUnit",dataType:"GPString",displayName:"Length Unit",direction:"esriGPParameterDirectionInput",description:"The length unit of maxSegmentLength, can be any esriUnits constant",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},difference:{name:"difference",displayName:"Difference",enabled:!0,description:"This operation constructs the set-theoretic difference between an array of geometries and another geometry",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?difference.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"An array of points, multipoints, polylines or polygons",parameterType:"esriGPParameterTypeRequired"},{name:"geometry",dataType:"Geometries",displayName:"Geometry",direction:"esriGPParameterDirectionInput",description:"A single geometry of any type, of dimension equal to or greater than the elements of geometries",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},distance:{name:"distance",displayName:"Distance",enabled:!0,description:"It reports the planar (projected space) or geodesic shortest distance between A and B",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?distance.html",parameters:[{name:"geometry1",dataType:"Geometries",displayName:"Geometry1",direction:"esriGPParameterDirectionInput",description:"The geometry from where the distance is to be measured",parameterType:"esriGPParameterTypeRequired"},{name:"geometry2",dataType:"Geometries",displayName:"Geometry2",direction:"esriGPParameterDirectionInput",description:"The geometry to which the distance is to be measured",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"distanceUnit",dataType:"GPString",displayName:"Distance Unit",direction:"esriGPParameterDirectionInput",description:"Specifies the units for measuring distance between the geometry1 and geometry2 geometries",parameterType:"esriGPParameterTypeOptional"},{name:"geodesic",dataType:"GPString",displayName:"Geodesic",direction:"esriGPParameterDirectionInput",description:"If true then measures the geodesic distance between the geometries geometry1 and geometry2",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},generalize:{name:"generalize",displayName:"Generalize",enabled:!0,description:"It returns generalized (Douglas-Poiker) versions of the input geometries",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?generalize.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be generalized",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"maxDeviation",dataType:"GPString",displayName:"Max Deviation",direction:"esriGPParameterDirectionInput",description:"Specifies the maximum deviation for constructing a generalized geometry based on the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"deviationUnit",dataType:"GPString",displayName:"Deviation Unit",direction:"esriGPParameterDirectionInput",description:"A unit for maximum deviation",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},intersect:{name:"intersect",displayName:"Intersect",enabled:!0,description:"This operation constructs the set-theoretic intersection between an array of geometries and another geometry",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?intersect.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"An array of points, multipoints, polylines or polygons",parameterType:"esriGPParameterTypeRequired"},{name:"geometry",dataType:"Geometries",displayName:"Geometry",direction:"esriGPParameterDirectionInput",description:"A single geometry of any type, of dimension equal to or greater than the elements of geometries",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},labelPoints:{name:"labelPoints",displayName:"Label Points",enabled:!0,description:"This operation calculates an interior point for each polygon specified in the input array",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?labelPoints.html",parameters:[{name:"polygons",dataType:"Geometries",displayName:"Geometry",direction:"esriGPParameterDirectionInput",description:"The array of polygons whose label points are to be computed",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input polygons",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},lengths:{name:"lengths",displayName:"Lengths",enabled:!0,description:"The array of polylines whose lengths are to be computed",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?lengths.html",parameters:[{name:"polylines",dataType:"Geometries",displayName:"Polylines",direction:"esriGPParameterDirectionInput",description:"The array of polylines whose lengths are to be computed",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input polylines",parameterType:"esriGPParameterTypeOptional"},{name:"lengthUnit",dataType:"GPString",displayName:"Length Unit",direction:"esriGPParameterDirectionInput",description:"The length unit in which perimeters of polygons will be calculated",parameterType:"esriGPParameterTypeOptional"},{name:"geodesic",dataType:"GPString",displayName:"Geodesic",direction:"esriGPParameterDirectionInput",description:"If polylines are in geographic coordinate system, then geodesic needs to be set to true in order to calculate the ellipsoidal shortest path distance between each pair of the vertices in the polylines. If lengthUnit is not specificed, then output is always returned in meters",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},offset:{name:"offset",displayName:"Offset",enabled:!0,description:"Offset constructs the offset of the given input geometries",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?offset.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be offset",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"offsetDistance",dataType:"GPString",displayName:"Offset Distance",direction:"esriGPParameterDirectionInput",description:"Specifies the distance for constructing an offset based on the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"offsetUnit",dataType:"GPString",displayName:"Offset Unit",direction:"esriGPParameterDirectionInput",description:"A unit for offset distance",parameterType:"esriGPParameterTypeOptional"},{name:"offsetHow",dataType:"GPString",displayName:"Offset How",direction:"esriGPParameterDirectionInput",description:"It is one of esriGeometryOffsetMitered, esriGeometryOffsetBevelled, esriGeometryOffsetRounded",parameterType:"esriGPParameterTypeOptional"},{name:"bevelRatio",dataType:"GPString",displayName:"Bevel Ratio",direction:"esriGPParameterDirectionInput",description:"bevelRatio is multiplied by the offset distance and the result determines how far a mitered offset intersection can be located before it is bevelled",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},project:{name:"project",displayName:"Project",enabled:!0,description:"This resource projects an array of input geometries from an input spatial reference to an output spatial reference",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?project.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be projected",parameterType:"esriGPParameterTypeRequired"},{name:"inSR",dataType:"GPString",displayName:"In Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeRequired"},{name:"outSR",dataType:"GPString",displayName:"Out Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the returned geometries",parameterType:"esriGPParameterTypeRequired"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},relation:{name:"relation",displayName:"Relation",enabled:!0,description:"This operation determines the pairs of geometries from the input geometry arrays that participate in the specified spatial relation",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?relation.html",parameters:[{name:"geometries1",dataType:"Geometries",displayName:"Geometries1",direction:"esriGPParameterDirectionInput",description:"The first array of geometries to compute the relations",parameterType:"esriGPParameterTypeRequired"},{name:"geometries2",dataType:"Geometries",displayName:"Geometries2",direction:"esriGPParameterDirectionInput",description:"The second array of geometries to compute the relations",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeRequired"},{name:"relation",dataType:"GPString",displayName:"Relation",direction:"esriGPParameterDirectionInput",description:"The spatial relationship to be tested between the two input geometry arrays",parameterType:"esriGPParameterTypeRequired"},{name:"relationParam",dataType:"GPString",displayName:"Relation Param",direction:"esriGPParameterDirectionInput",description:"The Shape-Comparison-Language string to be evaluated",parameterType:"esriGPParameterTypeRequired"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},reshape:{name:"reshape",displayName:"Reshape",enabled:!0,description:"It reshapes a polyline or a part of a polygon using a reshaping line",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?reshape.html",parameters:[{name:"target",dataType:"Geometries",displayName:"Target",direction:"esriGPParameterDirectionInput",description:"The polyline or polygon to be reshaped",parameterType:"esriGPParameterTypeRequired"},{name:"reshaper",dataType:"Geometries",displayName:"Reshaper",direction:"esriGPParameterDirectionInput",description:"The single-part polyline that does the reshaping",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input geometry",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},simplify:{name:"simplify",displayName:"Simplify",enabled:!0,description:"Simplify permanently alters the input geometry so that the geometry becomes topologically consistent",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?simplify.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be simplified",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID of the spatial reference or a spatial reference json object for the input and output geometries",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},trimExtend:{name:"trimExtend",displayName:"TrimExtend",enabled:!0,description:"This operation trims or extends each polyline specified in the input array, using the user specified guide polylines",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?trimExtend.html",parameters:[{name:"polylines",dataType:"Geometries",displayName:"Polylines",direction:"esriGPParameterDirectionInput",description:"An array of polylines whose lengths are to be computed",parameterType:"esriGPParameterTypeRequired"},{name:"trimExtendTo",dataType:"Geometries",displayName:"Trim Extend To",direction:"esriGPParameterDirectionInput",description:"A polyline which is used as a guide for trimming or extending input polylines",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input polylines",parameterType:"esriGPParameterTypeOptional"},{name:"extendHow",dataType:"GPString",displayName:"Extend How",direction:"esriGPParameterDirectionInput",description:"A flag which is used along with the trimExtend operation",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]},union:{name:"union",displayName:"Union",enabled:!0,description:"This operation constructs the set-theoretic union of the geometries in the input array",url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer",executionType:"esriExecutionTypeGeometry",helpUrl:"http://sampleserver1.arcgisonline.com/ArcGIS/SDK/REST/index.html?union.html",parameters:[{name:"geometries",dataType:"Geometries",displayName:"Geometries",direction:"esriGPParameterDirectionInput",description:"The array of geometries to be unioned",parameterType:"esriGPParameterTypeRequired"},{name:"sr",dataType:"GPString",displayName:"Spatial Reference",direction:"esriGPParameterDirectionInput",description:"The well-known ID or a spatial reference json object for the input geometries",parameterType:"esriGPParameterTypeOptional"},{name:"result",dataType:"Geometries",displayName:"Result",direction:"esriGPParameterDirectionOutput",description:"Result geometries for this operation",parameterType:"esriGPParameterTypeRequired"}]}};var t=function(a){this._init(a)};t.create=function(a,b){var c=new t(a);if(__not_null(b)){var d,e,f;a.url=b.typeProperties.url,a.displayName=b.name;for(e in b.inputPorts)d=b.inputPorts[e],a.createPort(e,d,"IN");for(e in b.outputPorts)d=b.outputPorts[e],a.createPort(e,d,"OUT");__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState)),c.updatePorts()}return c},t.ExecutionType="esriExecutionTypeAsynchronous",t.DefaultNodeHeight=i.GridSize*3,t.DefaultNodeWidth=i.GridSize*8,t.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=t.DefaultNodeHeight,this.nodW=t.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeGpAsync},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;if(a.executionType!==t.ExecutionType)throw new Error("GpSync.parseNodeJSON failed: "+t.ExecutionType+" mismatched with "+a.executionType);return!0},removePort:function(a){return!0},updatePorts:function(){var a=this.getNodeSymbol(),b,c=a.shapes.length;while(c-->0)b=a.shapes[c],b.getAttribute("port:symbol")===a&&a.removeAt(c);for(var d=this.node.getInPort(),e=this.node.getOutPort(),f=1,g=1,h;f<=d;f++)h=this.node.getInPort(f),i.createInPort(this.flowChart,a,h,this.nodW,g++);for(f=1;f<=e;f++)h=this.node.getOutPort(f),i.createOutPort(this.flowChart,a,h,this.nodW,g++);this.nodH=(d+e+2)*i.GridSize,this.nodH<t.DefaultNodeHeight&&(this.nodH=t.DefaultNodeHeight),i.updateDrawNode(a,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a,b=0,c=null,d="";d+=g,d+=h(this.node.id),d+=":{\n",d+=g+g,d+=h("name"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("type"),d+=":",d+=h(this.toString()),d+=",\n",d+=g+g,d+=h("nodeServiceName"),d+=":",d+=h(__base64.encode(this.node.serviceName)),d+=",\n",d+=g+g,d+=h("nodeServiceState"),d+=":",d+=h(__base64.encode(this.node.getServiceState())),d+=",\n";var e=this.node.tagShape.points[0],f=this.node.flowChart.mapCanvas.toViewPos(e.x,e.y);for(d+=g+g,d+=h("posX"),d+=":",d+=h(f.x.toFixed(0)),d+=",\n",d+=g+g,d+=h("posY"),d+=":",d+=h(f.y.toFixed(0)),d+=",\n",d+=g+g,d+=h("typeProperties"),d+=":{\n",d+=g+g+g,d+=h("url"),d+=":",d+=h(this.node.url),d+="\n",d+=g+g,d+="},\n",d+=g+g,d+=h("inputPorts"),d+=":{\n",b=this.node.inports.size(),a=1;a<b;a++)c=this.node.getInPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");for(d+=g+g,d+="},\n",d+=g+g,d+=h("outputPorts"),d+=":{\n",b=this.node.outports.size(),a=1;a<b;a++)c=this.node.getOutPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");d+=g+g,d+="}\n",d+=g;return d+="}"}};var u=function(a){this._init(a)};u.create=function(a,b){var c=new u(a);if(__not_null(b)){var d,e;a.url=b.typeProperties.url,a.displayName=b.name;for(e in b.inputPorts)d=b.inputPorts[e],a.createPort(e,d,"IN");for(e in b.outputPorts)d=b.outputPorts[e],a.createPort(e,d,"OUT");c.updatePorts(),__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState))}return c},u.ExecutionType="esriExecutionTypeSynchronous",u.DefaultNodeHeight=i.GridSize*3,u.DefaultNodeWidth=i.GridSize*8,u.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=u.DefaultNodeHeight,this.nodW=u.DefaultNodeWidth,i.initNodeDrawing(this.node)},toString:function(){return i.NodeGpSync},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;if(a.executionType!==u.ExecutionType)throw new Error("GpSync.parseNodeJSON failed: "+u.ExecutionType+" mismatched with "+a.executionType);return!0},removePort:function(a){return!0},updatePorts:function(){var a=this.getNodeSymbol(),b,c=a.shapes.length;while(c-->0)b=a.shapes[c],b.getAttribute("port:symbol")===a&&a.removeAt(c);for(var d=this.node.getInPort(),e=this.node.getOutPort(),f=1,g=1,h;f<=d;f++)h=this.node.getInPort(f),i.createInPort(this.flowChart,a,h,this.nodW,g++);for(f=1;f<=e;f++)h=this.node.getOutPort(f),i.createOutPort(this.flowChart,a,h,this.nodW,g++);this.nodH=(d+e+2)*i.GridSize,this.nodH<u.DefaultNodeHeight&&(this.nodH=u.DefaultNodeHeight),i.updateDrawNode(a,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a,b=0,c=null,d="";d+=g,d+=h(this.node.id),d+=":{\n",d+=g+g,d+=h("name"),d+=":",d+=h(this.node.displayName),d+=",\n",d+=g+g,d+=h("type"),d+=":",d+=h(this.toString()),d+=",\n",d+=g+g,d+=h("nodeServiceName"),d+=":",d+=h(__base64.encode(this.node.serviceName)),d+=",\n",d+=g+g,d+=h("nodeServiceState"),d+=":",d+=h(__base64.encode(this.node.getServiceState())),d+=",\n";var e=this.node.tagShape.points[0],f=this.node.flowChart.mapCanvas.toViewPos(e.x,e.y);for(d+=g+g,d+=h("posX"),d+=":",d+=h(f.x.toFixed(0)),d+=",\n",d+=g+g,d+=h("posY"),d+=":",d+=h(f.y.toFixed(0)),d+=",\n",d+=g+g,d+=h("typeProperties"),d+=":{\n",d+=g+g+g,d+=h("url"),d+=":",d+=h(this.node.url),d+="\n",d+=g+g,d+="},\n",d+=g+g,d+=h("inputPorts"),d+=":{\n",b=this.node.inports.size(),a=1;a<b;a++)c=this.node.getInPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");for(d+=g+g,d+="},\n",d+=g+g,d+=h("outputPorts"),d+=":{\n",b=this.node.outports.size(),a=1;a<b;a++)c=this.node.getOutPort(a),c.isValid()&&(d+=c.toJsonString(),a===b-1?d+="\n":d+=",\n");d+=g+g,d+="}\n",d+=g;return d+="}"}};var v=function(a){this._init(a)};v.create=function(a,b){var c=new v(a);c.updatePorts(b),__not_null(b)&&(__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState)));return c},v.ExecutionType="esriExecutionTypePubInput",v.DefaultNodeHeight=i.GridSize*3,v.DefaultNodeWidth=i.GridSize*6,v.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.orderNumb=this.flowChart.sortNodesOrder(i.NodePubInput),this.portName="",this._setNodeName(),this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=v.DefaultNodeHeight,this.nodW=v.DefaultNodeWidth,i.initNodeDrawing(this.node)},_setNodeName:function(a){this.portName=__not_empty(a)?a:"",this.node.name="Input"+this.orderNumb,__not_empty(this.portName)&&(this.node.name+="_"+this.portName),this.node.displayName=this.node.name},toString:function(){return i.NodePubInput},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;return!0},removePort:function(a){a.defaultValue=a.dataType=a.name="",this.updatePortText(a);return!0},updatePorts:function(a){var b,c,d=null,e=this.getNodeSymbol();__is_null(a)?b=new m(this.node.outports.genKey(),"OUT","",this.node):(b=new m(a.id,"OUT","",this.node),c=this.flowChart.getNodeById(a.knotId),__not_null(c)&&(d=c.getInPortById(a.portName))),b.required=!0,this.node.outports.insert(b.id,b),i.createOutPort(this.flowChart,e,b,this.nodW,1),i.updateDrawNode(e,this.nodW,this.nodH,this.getDisplayName()),__not_null(d)&&this.flowChart.addLink(b,d)},updateOutPort:function(a,b){a.fromPort.name=a.toPort.name,a.fromPort.dataType=a.toPort.dataType,a.fromPort.defaultValue=a.toPort.defaultValue,this.updatePortText(a.fromPort)},updateOrderNumb:function(a){this.orderNumb=a,this._setNodeName(this.portName),i.updateDrawNode(this.getNodeSymbol(),this.nodW,this.nodH,this.getDisplayName())},updatePortText:function(a){this._setNodeName(a.name);var b,c=this.getNodeSymbol(),d=c.shapes.length;while(d-->0)b=c.shapes[d],b.tag===a&&(b.getAttribute("PORT_TEXT")===!0&&b.addAttribute("TEXT",a.name));i.updateDrawNode(c,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a="";a+=g,a+=h(this.getDisplayName()),a+=":{\n",a+=g+g,a+=h("id"),a+=":",a+=h(this.node.id),a+=",\n",a+=g+g,a+=h("name"),a+=":",a+=h(this.node.name),a+=",\n",a+=g+g,a+=h("nodeServiceName"),a+=":",a+=h(__base64.encode(this.node.serviceName)),a+=",\n",a+=g+g,a+=h("nodeServiceState"),a+=":",a+=h(__base64.encode(this.node.getServiceState())),a+=",\n";var b=this.node.tagShape.points[0],c=this.node.flowChart.mapCanvas.toViewPos(b.x,b.y);a+=g+g,a+=h("posX"),a+=":",a+=h(c.x.toFixed(0)),a+=",\n",a+=g+g,a+=h("posY"),a+=":",a+=h(c.y.toFixed(0)),a+=",\n";var d=this.node.getOutPort(1),e=d.getNextLink();a+=g+g,a+=h("dataType"),a+=":",a+=h(d.dataType),a+=",\n",a+=g+g,a+=h("defaultValue"),a+=":",a+=h(d.defaultValue),a+=",\n",a+=g+g,a+=h("knotId"),a+=":",a+=h(__not_null(e)?e.toNode.id:""),a+=",\n",a+=g+g,a+=h("portName"),a+=":",a+=h(__not_null(e)?e.toPort.name:""),a+="\n",a+=g;return a+="}"}};var w=function(a){this._init(a)};w.create=function(a,b){var c=new w(a);c.updatePorts(b),__not_null(b)&&(c.setCallout(b.callout),__not_null(b.nodeServiceName)&&a.setServiceState(__base64.decode(b.nodeServiceName),__base64.decode(b.nodeServiceState)));return c},w.ExecutionType="esriExecutionTypePubOutput",w.DefaultNodeHeight=i.GridSize*3,w.DefaultNodeWidth=i.GridSize*6,w.prototype={_init:function(a){this.node=a,this.node.typedNode=this,this.flowChart=a.flowChart,this.orderNumb=this.flowChart.sortNodesOrder(i.NodePubOutput),this.callout=this.portName="",this._setNodeName(),this.node.tagShape.symbol=new esri2.Map.Symbol(this.toString(),this.node),this.nodH=w.DefaultNodeHeight,this.nodW=w.DefaultNodeWidth,i.initNodeDrawing(this.node)},_setNodeName:function(a){this.portName=__not_empty(a)?a:"",this.node.name="Output"+this.orderNumb,__not_empty(this.portName)&&(this.node.name+="_"+this.portName),this.node.displayName=this.node.name},toString:function(){return i.NodePubOutput},setCallout:function(a){try{this.callout=a.replace(/\"/g,"")}catch(b){this.callout=""}},getDisplayName:function(){return this.node.displayName},getNodeSymbol:function(){return this.node.tagShape.symbol},parseNodeJSON:function(a){if(__is_null(a))return!1;return!0},removePort:function(a){a.dataType=a.name="",this.updatePortText(a);return!0},updatePorts:function(a){var b,c,d=null,e=this.getNodeSymbol();__is_null(a)?b=new m(this.node.outports.genKey(),"IN","",this.node):(b=new m(a.id,"IN","",this.node),c=this.flowChart.getNodeById(a.knotId),__not_null(c)&&(d=c.getOutPortById(a.portName))),b.required=!0,this.node.inports.insert(b.id,b),i.createInPort(this.flowChart,e,b,this.nodW,1),i.updateDrawNode(e,this.nodW,this.nodH,this.getDisplayName()),__not_null(d)&&this.flowChart.addLink(d,b)},updateInPort:function(a,b){a.toPort.name=a.fromPort.name,a.toPort.dataType=a.fromPort.dataType,this.updatePortText(a.toPort)},updateOrderNumb:function(a){this.orderNumb=a,this._setNodeName(this.portName),i.updateDrawNode(this.getNodeSymbol(),this.nodW,this.nodH,this.getDisplayName())},updatePortText:function(a){this._setNodeName(a.name);var b,c=this.getNodeSymbol(),d=c.shapes.length;while(d-->0)b=c.shapes[d],b.tag===a&&(b.getAttribute("PORT_TEXT")===!0&&b.addAttribute("TEXT",a.name));i.updateDrawNode(c,this.nodW,this.nodH,this.getDisplayName())},toJsonString:function(){var a="";a+=g,a+=h(this.getDisplayName()),a+=":{\n",a+=g+g,a+=h("id"),a+=":",a+=h(this.node.id),a+=",\n",a+=g+g,a+=h("name"),a+=":",a+=h(this.node.displayName),a+=",\n",a+=g+g,a+=h("callout"),a+=":",a+=h(this.callout),a+=",\n",a+=g+g,a+=h("nodeServiceName"),a+=":",a+=h(__base64.encode(this.node.serviceName)),a+=",\n",a+=g+g,a+=h("nodeServiceState"),a+=":",a+=h(__base64.encode(this.node.getServiceState())),a+=",\n";var b=this.node.tagShape.points[0],c=this.node.flowChart.mapCanvas.toViewPos(b.x,b.y);a+=g+g,a+=h("posX"),a+=":",a+=h(c.x.toFixed(0)),a+=",\n",a+=g+g,a+=h("posY"),a+=":",a+=h(c.y.toFixed(0)),a+=",\n";var d=this.node.getInPort(1),e=d.getNextLink();a+=g+g,a+=h("knotId"),a+=":",a+=h(__not_null(e)?e.fromNode.id:""),a+=",\n",a+=g+g,a+=h("portName"),a+=":",a+=h(__not_null(e)?e.fromPort.name:""),a+="\n",a+=g;return a+="}"}},a.esri2.GeoFlow=k,a.esri2.GeoFlow.Node=l,a.esri2.GeoFlow.Port=m,a.esri2.GeoFlow.Link=n,a.esri2.GeoFlow.NodeTypes=i,a.esri2.GeoFlow.Node.Geometry=s,a.esri2.GeoFlow.Node.Feature=r}(window);;